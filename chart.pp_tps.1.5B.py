import matplotlib.pyplot as plt
import pandas as pd
from io import StringIO

# Your data as a string (you can also read from a file)
data = """prompt_tps	accel_type
30896	GPU
27892	GPU
27681	GPU
27559	GPU
25807	GPU
25164	GPU
24549	GPU
19804	GPU
19620	GPU
18590	GPU
18337	GPU
18255	GPU
17686	GPU
17080	GPU
16736	GPU
16482	GPU
16447	GPU
16292	GPU
16125	GPU
16091	GPU
15575	GPU
15370	GPU
15261	GPU
15252	GPU
15175	GPU
15156	GPU
15093	GPU
14676	GPU
14632	GPU
14610	GPU
14601	GPU
14584	GPU
14470	GPU
14233	GPU
14206	GPU
14169	GPU
14107	GPU
14061	GPU
13990	GPU
13974	GPU
13805	GPU
13799	GPU
13606	GPU
13517	GPU
13357	GPU
13196	GPU
13191	GPU
13164	GPU
13164	GPU
13125	GPU
12969	GPU
12964	GPU
12960	GPU
12894	GPU
12782	GPU
12717	GPU
12562	GPU
12344	GPU
12253	GPU
12246	GPU
12204	GPU
12108	GPU
11930	GPU
11835	GPU
11674	GPU
11628	GPU
11568	GPU
11478	GPU
11382	GPU
11035	GPU
10806	GPU
10794	GPU
10791	GPU
10703	GPU
10569	GPU
10392	GPU
10328	GPU
10144	GPU
10074	GPU
9991	GPU
9892	GPU
9743	GPU
9611	GPU
9573	GPU
9571	GPU
9533	GPU
9524	GPU
9463	GPU
9424	GPU
9356	GPU
9351	GPU
9337	GPU
9253	GPU
9161	GPU
9134	GPU
8984	GPU
8943	GPU
8883	GPU
8826	GPU
8777	GPU
8762	GPU
8761	GPU
8712	GPU
8708	GPU
8699	GPU
8609	GPU
8579	GPU
8549	GPU
8404	GPU
8328	GPU
8285	GPU
8237	GPU
8206	GPU
8050	GPU
7901	GPU
7853	GPU
7662	GPU
7658	GPU
7408	GPU
7201	GPU
7163	GPU
6976	GPU
6655	GPU
6597	GPU
6502	GPU
6358	GPU
6350	GPU
6259	GPU
6191	GPU
6151	GPU
6119	GPU
6085	GPU
6025	GPU
6022	GPU
6019	GPU
5800	GPU
5553	GPU
5176	GPU
5096	GPU
4979	GPU
4908	GPU
4902	GPU
4875	GPU
4609	GPU
4587	GPU
4585	GPU
4439	GPU
4363	GPU
4298	GPU
4094	GPU
4089	GPU
4078	GPU
4075	GPU
4047	GPU
3829	GPU
3734	GPU
3700	GPU
3646	GPU
3644	GPU
3399	GPU
3355	GPU
3324	GPU
3192	GPU
3091	GPU
3077	GPU
3054	GPU
3031	GPU
3003	GPU
2993	GPU
2944	GPU
2750	GPU
2665	GPU
2606	GPU
2600	GPU
2592	GPU
2563	GPU
2552	GPU
2516	GPU
2512	GPU
2494	GPU
2475	GPU
2378	GPU
2052	GPU
1770	GPU
1738	CPU
1609	CPU
1502	GPU
1233	GPU
1195	CPU
1057	GPU
1013	GPU
898	CPU
814	GPU
792	GPU
690	GPU
690	CPU
688	CPU
687	CPU
677	CPU
666	GPU
663	CPU
656	CPU
599	GPU
596	CPU
577	CPU
567	GPU
566	CPU
551	CPU
540	GPU
525	CPU
524	CPU
513	CPU
509	CPU
501	CPU
496	CPU
489	CPU
479	CPU
477	CPU
470	CPU
461	CPU
451	CPU
447	CPU
436	CPU
431	CPU
418	CPU
415	CPU
409	CPU
400	CPU
400	CPU
380	CPU
370	CPU
369	CPU
361	CPU
357	CPU
354	CPU
350	CPU
350	CPU
340	CPU
335	CPU
328	CPU
325	CPU
323	CPU
321	CPU
316	CPU
313	CPU
311	GPU
308	CPU
305	CPU
303	CPU
302	CPU
292	CPU
280	CPU
280	CPU
278	CPU
277	CPU
275	CPU
273	CPU
273	CPU
272	CPU
270	CPU
269	CPU
266	CPU
260	CPU
255	CPU
254	CPU
246	CPU
244	CPU
242	CPU
241	CPU
239	CPU
236	CPU
235	CPU
234	CPU
233	CPU
233	CPU
232	CPU
226	CPU
225	CPU
223	CPU
220	CPU
216	CPU
214	CPU
208	CPU
202	CPU
197	CPU
196	CPU
195	CPU
195	CPU
195	CPU
195	CPU
188	CPU
187	CPU
183	CPU
181	CPU
180	CPU
180	CPU
178	CPU
175	CPU
174	CPU
171	CPU
161	CPU
158	CPU
157	CPU
157	CPU
156	CPU
154	CPU
153	CPU
153	CPU
145	CPU
142	CPU
141	CPU
139	CPU
138	CPU
138	CPU
133	CPU
132	CPU
130	CPU
126	CPU
125	CPU
123	CPU
122	CPU
121	CPU
118	CPU
118	CPU
115	CPU
113	CPU
110	CPU
108	CPU
108	CPU
106	CPU
106	CPU
105	CPU
105	CPU
103	CPU
103	CPU
101	CPU
101	CPU
99	CPU
98	CPU
97	CPU
96	CPU
96	CPU
96	CPU
95	CPU
95	CPU
91	CPU
91	CPU
90	CPU
89	CPU
88	CPU
87	CPU
86	CPU
84	CPU
82	CPU
82	CPU
76	CPU
75	CPU
73	CPU
72	CPU
70	CPU
70	CPU
66	CPU
66	CPU
62	CPU
61	CPU
59	CPU
57	CPU
55	CPU
54	CPU
52	CPU
51	CPU
47	CPU
47	CPU
41	CPU
41	CPU
40	CPU
39	CPU
39	CPU
39	CPU
38	CPU
37	CPU
35	CPU
35	CPU
35	CPU
34	CPU
34	CPU
33	CPU
33	CPU
31	CPU
30	CPU
29	CPU
29	CPU
25	CPU
24	CPU
24	CPU
23	CPU
22	CPU
14	CPU
13	CPU
10	CPU
9	CPU
7	CPU
7	CPU
6	CPU
6	CPU
2	CPU
"""

# Read the data into a pandas DataFrame
df = pd.read_csv(StringIO(data), sep='\t')

# Create value indexes (0 to len(df)-1)
value_indexes = range(len(df))

# Create colors: green for GPU, red for CPU
colors = ['green' if accel == 'GPU' else 'red' for accel in df['accel_type']]

# Create the bar chart
plt.figure(figsize=(15, 8))
bars = plt.bar(value_indexes, df['prompt_tps'], color=colors, alpha=0.7)

# Customize the chart
plt.xlabel('Value Index')
plt.ylabel('Prompt processing [tokens/s]')
plt.yscale('log')
plt.title('1.5B Prompt Processing vs Value Index by Accelerator Type')
plt.grid(True, which='both', axis='both', alpha=0.3, ls="-")


# Create legend
from matplotlib.patches import Patch
legend_elements = [Patch(facecolor='green', alpha=0.7, label='GPU'),
                   Patch(facecolor='red', alpha=0.7, label='CPU')]
plt.legend(handles=legend_elements)


# Adjust layout and show
plt.tight_layout()
# plt.show()

#save result to png file
plt.savefig('pp_tps_vs_value_index.1.5B.png', dpi=300, bbox_inches='tight')
